<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ•ãƒ«ãƒ¼ãƒ„ãƒ»ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆ3å•ã‚¯ãƒªã‚¢ãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ï¼‰</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --ink: #e5e7eb;
      --muted: #94a3b8;
      --accent: #22c55e;
      --brand: #60a5fa;
      --bar: rgba(148,163,184,.25);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: linear-gradient(180deg,#0b1220,#0f172a 40%,#0b1220);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
        "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", Meiryo, sans-serif;
      color: var(--ink);
    }
    .wrap { max-width: 880px; margin: 40px auto; padding: 24px; }
    .card {
      position: relative;
      background: rgba(17,24,39,.8);
      border: 1px solid rgba(148,163,184,.15);
      box-shadow: 0 20px 40px rgba(0,0,0,.35);
      border-radius: 24px;
      padding: 32px;
      overflow: hidden;
    }
    h1 {
      margin: 0 0 12px;
      font-weight: 800;
      font-size: clamp(22px, 3.6vw, 34px);
      letter-spacing: .2px;
    }
    .badge {
      background: rgba(96,165,250,.15);
      color: #bae6fd;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
    }
    .sub {
      color: var(--muted);
      margin-bottom: 24px;
      line-height: 1.6;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .stat {
      background: #0b1020;
      border:1px solid rgba(148,163,184,.12);
      border-radius: 12px;
      padding: 14px 16px;
      min-width: 150px;
    }
    .label {
      font-size: 12px;
      color: var(--muted);
    }
    .val {
      font-size: 24px;
      font-weight: 700;
      margin-top: 4px;
    }

    .progress-area {
      margin: 30px 0 18px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
    }
    .marathon {
      display: flex;
      align-items: flex-end;
      gap: 18px;
      width: 100%;
    }
    .marker {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
    }
    .marker svg {
      width: 64px;
      height: 64px;
      filter: drop-shadow(0 8px 18px rgba(15,23,42,.55));
    }
    .track {
      flex: 1;
      position: relative;
      padding-top: 28px;
    }
    .slots {
      display: flex;
      width: 100%;
      gap: 10px;
    }
    .slot {
      flex: 1;
      height: 16px;
      border-radius: 999px;
      background: var(--bar);
      position: relative;
      overflow: hidden;
    }
    .slot::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg,#34d399,#22c55e);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .25s ease;
    }
    .slot.filled::after {
      transform: scaleX(1);
    }
    .runner {
      position: absolute;
      top: -4px;
      left: 2%;
      width: 130px;
      pointer-events: none;
      animation: runner-bounce 1s ease-in-out infinite;
      transition: left .35s ease;
      transform: translate(-50%, 0);
      filter: drop-shadow(0 0 12px rgba(96,165,250,.45));
    }
    .runner.paused { animation-play-state: paused; opacity: .7; }
    .runner.celebrate { animation: runner-celebrate .5s ease-in-out infinite alternate; }
    .runner svg {
      width: 100%;
      height: auto;
      fill: none;
      stroke: var(--brand);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    @keyframes runner-bounce {
      0%,100% { transform: translate(-50%, 0); }
      50% { transform: translate(-50%, -8px); }
    }
    @keyframes runner-celebrate {
      0% { transform: translate(-50%, -6px) rotate(-3deg); }
      100% { transform: translate(-50%, 6px) rotate(3deg); }
    }

    .word-display {
      margin: 24px 0;
      padding: 30px;
      background: #0a0f1d;
      border:1px dashed rgba(148,163,184,.25);
      border-radius: 20px;
      text-align: center;
    }
    .word-display .kana {
      font-size: clamp(36px, 5vw, 56px);
      font-weight: 800;
      letter-spacing: .05em;
    }

    input[type="text"] {
      width: 100%;
      padding: 16px 18px;
      font-size: 20px;
      color: #0b1220;
      background: #fdf2f8;
      border: none;
      border-radius: 14px;
      outline: none;
    }
    input[disabled] { opacity:.65; cursor: not-allowed; }

    .controls {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 18px;
      border-radius: 12px;
      border:1px solid rgba(148,163,184,.22);
      background:#0b1220;
      color: var(--ink);
      cursor: pointer;
      font-weight: 700;
    }
    button.primary {
      background: linear-gradient(180deg,#2563eb,#1d4ed8);
      border-color: transparent;
    }
    button:disabled { opacity:.6; cursor: not-allowed; }

    .hint {
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px;
      line-height: 1.5;
    }
    .footer {
      margin-top: 28px;
      color: var(--muted);
      font-size: 13px;
      display:flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .countdown {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(48px, 8vw, 120px);
      font-weight: 800;
      color: #f8fafc;
      background: rgba(15,23,42,.85);
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
    }
    .countdown.show {
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 640px){
      .wrap { padding: 16px; }
      .card { padding: 22px; }
      .runner { width: 110px; }
      .marker svg { width: 50px; height: 50px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ãƒ•ãƒ«ãƒ¼ãƒ„ãƒ»ã‚¿ã‚¤ãƒ”ãƒ³ã‚° <span class="badge">3å•é€£ç¶šã‚¯ãƒªã‚¢ã®ã‚¿ã‚¤ãƒ ã‚’è¨ˆæ¸¬</span></h1>
      <div class="sub">
        ã²ã‚‰ãŒãªã§è¡¨ç¤ºã•ã‚Œã‚‹ãƒ•ãƒ«ãƒ¼ãƒ„åã‚’ã€<strong>ã²ã‚‰ãŒãªå…¥åŠ›</strong>ã§ãã®ã¾ã¾æ‰“ã¡è¾¼ã‚€ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã€‚<br>
        ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã¾ãŸã¯ Enter ã§ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆ3ãƒ»2ãƒ»1ï¼‰ãŒå§‹ã¾ã‚Šã€3å•æ­£è§£ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’ç«¶ã„ã¾ã™ã€‚
      </div>

      <div class="row" id="stats">
        <div class="stat">
          <div class="label">çµŒéæ™‚é–“</div>
          <div class="val" id="elapsed">0.0s</div>
        </div>
        <div class="stat">
          <div class="label">ã‚¯ãƒªã‚¢æ•°</div>
          <div class="val"><span id="cleared">0</span> / 3</div>
        </div>
      </div>

      <div class="progress-area">
        <div class="marathon" aria-label="3åŒºé–“ã®ãƒãƒ©ã‚½ãƒ³ãƒˆãƒ©ãƒƒã‚¯">
          <div class="marker marker-start">
            <svg viewBox="0 0 64 64" role="img" aria-label="ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹">
              <rect x="10" y="10" width="6" height="46" fill="#38bdf8"></rect>
              <rect x="48" y="10" width="6" height="46" fill="#38bdf8"></rect>
              <rect x="16" y="10" width="32" height="14" rx="4" fill="#22c55e"></rect>
              <path d="M16 26 L48 26" stroke="#38bdf8" stroke-width="2"></path>
            </svg>
            <span>ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
          </div>
          <div class="track">
            <div class="runner paused" id="runner" aria-hidden="true">
              <svg viewBox="0 0 80 60">
                <circle cx="48" cy="12" r="8"></circle>
                <path d="M32 54 L42 32 L32 26" />
                <path d="M42 32 L56 42" />
                <path d="M42 32 L30 40" />
                <path d="M42 20 L28 28" />
                <path d="M42 20 L56 24" />
              </svg>
            </div>
            <div class="progress slots" id="progress" aria-label="ã‚¯ãƒªã‚¢çŠ¶æ³ï¼ˆ3åŒºé–“ï¼‰">
              <span class="slot"></span>
              <span class="slot"></span>
              <span class="slot"></span>
            </div>
          </div>
          <div class="marker marker-goal">
            <svg viewBox="0 0 64 64" role="img" aria-label="ã‚´ãƒ¼ãƒ«">
              <rect x="14" y="8" width="6" height="48" fill="#fbbf24"></rect>
              <path d="M20 10 L50 10 L42 22 L50 34 L20 34 Z" fill="#f43f5e" opacity=".9"></path>
              <path d="M20 10 L36 10 L28 22 L36 34 L20 34 Z" fill="#fef3c7" opacity=".8"></path>
            </svg>
            <span>ã‚´ãƒ¼ãƒ«</span>
          </div>
        </div>
      </div>

      <div class="word-display">
        <div class="kana" id="currentKana">---</div>
      </div>

      <input
        id="input"
        type="text"
        lang="ja"
        inputmode="kana"
        autocomplete="off"
        placeholder="ä¾‹ï¼šã‚Šã‚“ã” â†’ ã‚Šã‚“ã”ï¼ˆPCã§ã‚‚æ—¥æœ¬èªå…¥åŠ›ãƒ»ã²ã‚‰ãŒãªãƒ¢ãƒ¼ãƒ‰ã§ï¼‰"
        disabled
      />
      <div class="hint">
        PCã§ã‚‚ã‚¹ãƒãƒ›ã§ã‚‚æ—¥æœ¬èªå…¥åŠ›ï¼ˆã²ã‚‰ãŒãªï¼‰ã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ã€‚ç­”ãˆã®ã²ã‚‰ãŒãªã¨å®Œå…¨ã«ä¸€è‡´ã—ãŸã‚‰è‡ªå‹•ã§æ¬¡ã®å•é¡Œã«é€²ã¿ã¾ã™ã€‚
      </div>

      <div class="controls">
        <button class="primary" id="btnStart">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="btnRestart" disabled>ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      </div>

      <div class="footer">
        <div>å˜èªãƒªã‚¹ãƒˆ: ãƒ•ãƒ«ãƒ¼ãƒ„ï¼ˆã²ã‚‰ãŒãªï¼‰</div>
        <div>æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢ï¼šæ¿éŸ³ãƒ»æ‹—éŸ³ã‚„ãƒ©ãƒƒãƒ—è¨ˆæ¸¬ã€èªå½™ã‚«ã‚¹ã‚¿ãƒ ãªã©</div>
      </div>

      <div class="countdown" id="countdown" aria-live="assertive"></div>
    </div>
  </div>

  <script>
    const FRUITS = [
      { kana: "ã‚Šã‚“ã”",      roma: "ringo" },
      { kana: "ã¿ã‹ã‚“",      roma: "mikan" },
      { kana: "ã¶ã©ã†",      roma: "budou" },
      { kana: "ã„ã¡ã”",      roma: "ichigo" },
      { kana: "ã‚‚ã‚‚",        roma: "momo" },
      { kana: "ã™ã„ã‹",      roma: "suika" },
      { kana: "ãªã—",        roma: "nashi" },
      { kana: "ã‹ã",        roma: "kaki" },
      { kana: "ã•ãã‚‰ã‚“ã¼",  roma: "sakuranbo" },
      { kana: "ãƒãƒŠãƒŠ",      roma: "banana" },
      { kana: "ã‚­ã‚¦ã‚¤",      roma: "kiui" },
      { kana: "ãƒ‘ã‚¤ãƒŠãƒƒãƒ—ãƒ«",roma: "painappuru" },
      { kana: "ãƒãƒ³ã‚´ãƒ¼",    roma: "mango" },
      { kana: "ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„", roma: "gureepufurutsu" },
      { kana: "ãƒ¬ãƒ¢ãƒ³",      roma: "remon" },
      { kana: "ãƒ©ã‚¤ãƒ ",      roma: "raimu" },
      { kana: "ãƒ¡ãƒ­ãƒ³",      roma: "meron" },
      { kana: "ãƒ‘ãƒ‘ã‚¤ãƒ¤",    roma: "papaiya" },
      { kana: "ãƒ©ãƒ•ãƒ©ãƒ³ã‚¹",  roma: "rafuransu" },
      { kana: "ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼",roma: "buruuberii" },
      { kana: "ãƒ©ã‚ºãƒ™ãƒªãƒ¼",  roma: "razuberii" },
      { kana: "ã‚ªãƒ¬ãƒ³ã‚¸",    roma: "orenji" }
    ];

    const GOAL_COUNT = 3;
    const RUNNER_POSITIONS = ["2%", "38%", "70%", "100%"];
    const state = {
      words: [],
      idx: 0,
      startedAt: null,
      finished: false,
      timerId: null,
      correct: 0,
      countdownActive: false,
      countdownTimeouts: [],
    };

    const $ = (sel) => document.querySelector(sel);
    const fmt = (n, digits = 1) =>
      (Math.round(n * Math.pow(10, digits)) / Math.pow(10, digits)).toFixed(digits);

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function ensureWordPool(){
      if(state.idx >= state.words.length){
        state.words = state.words.concat(shuffle(FRUITS));
      }
    }

    function showCurrentWord(){
      ensureWordPool();
      const current = state.words[state.idx] || { kana: "---" };
      $("#currentKana").textContent = current.kana;
    }

    function updateProgress(){
      $("#cleared").textContent = state.correct;
      document.querySelectorAll(".progress .slot").forEach((slot, idx) => {
        slot.classList.toggle("filled", idx < state.correct);
      });
    }

    function updateRunnerPosition(){
      const runner = $("#runner");
      if(!runner) return;
      const idx = Math.min(state.correct, RUNNER_POSITIONS.length - 1);
      runner.style.left = RUNNER_POSITIONS[idx];
    }

    function updateStats(){
      const elapsed = state.startedAt ? Date.now() - state.startedAt : 0;
      $("#elapsed").textContent = fmt(elapsed / 1000, 1) + "s";
    }

    function setRunnerState(){
      const runner = $("#runner");
      if(!runner) return;
      runner.classList.toggle("paused", !state.startedAt || state.finished);
      runner.classList.toggle("celebrate", state.finished);
    }

    function tick(){
      if(state.startedAt && !state.finished){
        updateStats();
      }
    }

    function clearCountdown(){
      state.countdownTimeouts.forEach((id)=>clearTimeout(id));
      state.countdownTimeouts = [];
      state.countdownActive = false;
      const overlay = $("#countdown");
      overlay.classList.remove("show");
      overlay.textContent = "";
    }

    function init(){
      clearInterval(state.timerId);
      state.timerId = null;
      clearCountdown();
      state.words = shuffle(FRUITS);
      state.idx = 0;
      state.startedAt = null;
      state.finished = false;
      state.correct = 0;
      $("#input").value = "";
      $("#input").disabled = true;
      $("#btnStart").disabled = false;
      $("#btnRestart").disabled = true;
      updateProgress();
      updateStats();
      updateRunnerPosition();
      showCurrentWord();
      setRunnerState();
    }

    function beginRun(){
      if(state.startedAt) return;
      state.startedAt = Date.now();
      state.timerId = setInterval(tick, 100);
      $("#input").disabled = false;
      $("#input").focus();
      $("#btnRestart").disabled = false;
      setRunnerState();
    }

    function startCountdown(){
      if(state.countdownActive || state.startedAt || state.finished) return;
      state.countdownActive = true;
      $("#btnStart").disabled = true;
      const overlay = $("#countdown");
      const steps = ["3","2","1"];
      overlay.textContent = "";
      overlay.classList.add("show");
      steps.forEach((val, idx) => {
        const id = setTimeout(() => {
          overlay.textContent = val;
          if(idx === steps.length - 1){
            const startId = setTimeout(() => {
              overlay.classList.remove("show");
              overlay.textContent = "";
              state.countdownActive = false;
              beginRun();
            }, 800);
            state.countdownTimeouts.push(startId);
          }
        }, idx * 800);
        state.countdownTimeouts.push(id);
      });
    }

    function handleCorrect(){
      state.correct++;
      state.idx++;
      $("#input").value = "";
      updateProgress();
      updateRunnerPosition();
      if(state.correct >= GOAL_COUNT){
        finish();
      } else {
        showCurrentWord();
      }
    }

    function handleInput(){
      if(!state.startedAt || state.finished) return;
      const typed = $("#input").value.trim();
      const current = state.words[state.idx] || { kana: "" };
      if(typed && typed === current.kana){
        handleCorrect();
      }
    }

    function finish(){
      if(state.finished) return;
      state.finished = true;
      clearInterval(state.timerId);
      state.timerId = null;
      $("#input").disabled = true;
      updateStats();
      setRunnerState();
      updateRunnerPosition();
      const total = state.startedAt ? fmt((Date.now() - state.startedAt)/1000, 1) : "0.0";
      setTimeout(()=>alert(`ğŸ 3å•ã‚¯ãƒªã‚¢ï¼ã‚¿ã‚¤ãƒ : ${total}s`), 80);
    }

    $("#btnStart").addEventListener("click", startCountdown);
    $("#btnRestart").addEventListener("click", init);
    $("#input").addEventListener("input", handleInput);
    $("#input").addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
      }
    });
    document.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && !state.startedAt && !state.countdownActive && !state.finished){
        e.preventDefault();
        startCountdown();
      }
    });

    init();
  </script>
</body>
</html>
