<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ•ãƒ«ãƒ¼ãƒ„ãƒ»ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ï¼ˆ3å•ã‚¯ãƒªã‚¢ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ï¼‰</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --ink: #e5e7eb;
      --muted: #94a3b8;
      --accent: #22c55e;
      --danger: #f43f5e;
      --brand: #60a5fa;
      --bar: rgba(148,163,184,.25);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: linear-gradient(180deg,#0b1220,#0f172a 40%,#0b1220);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
        "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", Meiryo, sans-serif;
      color: var(--ink);
    }
    .wrap { max-width: 860px; margin: 40px auto; padding: 24px; }
    .card {
      background: rgba(17,24,39,.78);
      border: 1px solid rgba(148,163,184,.15);
      box-shadow: 0 20px 40px rgba(0,0,0,.35);
      border-radius: 24px;
      padding: 32px;
    }
    h1 {
      margin: 0 0 10px;
      font-weight: 800;
      font-size: clamp(22px, 3.6vw, 34px);
      letter-spacing: .2px;
    }
    .sub {
      color: var(--muted);
      margin-bottom: 24px;
      line-height: 1.6;
    }
    .badge {
      background: rgba(96,165,250,.15);
      color: #bae6fd;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .stat {
      background: #0b1020;
      border:1px solid rgba(148,163,184,.12);
      border-radius: 12px;
      padding: 14px 16px;
      min-width: 150px;
    }
    .label {
      font-size: 12px;
      color: var(--muted);
    }
    .val {
      font-size: 24px;
      font-weight: 700;
      margin-top: 2px;
    }

    .progress-area {
      margin: 28px 0 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      align-items: center;
    }
    .runner {
      width: 140px;
      animation: runner-bounce 1s ease-in-out infinite;
    }
    .runner.paused {
      animation-play-state: paused;
      opacity: .65;
    }
    .runner.celebrate {
      animation: runner-celebrate .5s ease-in-out infinite alternate;
    }
    .runner svg {
      width: 100%;
      height: auto;
      fill: none;
      stroke: var(--brand);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: drop-shadow(0 0 12px rgba(96,165,250,.45));
    }
    @keyframes runner-bounce {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
    @keyframes runner-celebrate {
      0% { transform: translateY(-4px) rotate(-3deg); }
      100% { transform: translateY(4px) rotate(3deg); }
    }
    .progress {
      display: flex;
      width: 100%;
      gap: 10px;
    }
    .slot {
      flex: 1;
      height: 16px;
      border-radius: 999px;
      background: var(--bar);
      position: relative;
      overflow: hidden;
    }
    .slot::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg,#34d399,#22c55e);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .3s ease;
    }
    .slot.filled::after {
      transform: scaleX(1);
    }

    .word-display {
      margin: 24px 0;
      padding: 28px;
      background: #0a0f1d;
      border:1px dashed rgba(148,163,184,.25);
      border-radius: 20px;
      text-align: center;
    }
    .word-display .kana {
      font-size: clamp(32px, 4vw, 48px);
      font-weight: 800;
    }
    .word-display .roma {
      font-size: 16px;
      color: var(--muted);
      letter-spacing: .12em;
      margin-top: 8px;
      text-transform: lowercase;
    }

    input[type="text"] {
      width: 100%;
      padding: 16px 18px;
      font-size: 18px;
      color: #0b1220;
      background: #eef2ff;
      border: none;
      border-radius: 14px;
      outline: none;
    }
    input[disabled] { opacity:.6; }

    .controls {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 18px;
      border-radius: 12px;
      border:1px solid rgba(148,163,184,.22);
      background:#0b1220;
      color: var(--ink);
      cursor: pointer;
      font-weight: 700;
    }
    button.primary {
      background: linear-gradient(180deg,#2563eb,#1d4ed8);
      border-color: transparent;
    }
    button:disabled { opacity:.6; cursor: not-allowed; }

    .hint {
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px;
      line-height: 1.5;
    }
    .footer {
      margin-top: 28px;
      color: var(--muted);
      font-size: 13px;
      display:flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    @media (max-width: 640px){
      .wrap { padding: 16px; }
      .card { padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ãƒ•ãƒ«ãƒ¼ãƒ„ãƒ»ã‚¿ã‚¤ãƒ”ãƒ³ã‚° <span class="badge">3å•é€£ç¶šã‚¯ãƒªã‚¢ã®ã‚¿ã‚¤ãƒ ã‚’è¨ˆæ¸¬</span></h1>
      <div class="sub">
        ã²ã‚‰ãŒãªã§è¡¨ç¤ºã•ã‚Œã‚‹ãƒ•ãƒ«ãƒ¼ãƒ„åã‚’ãƒ­ãƒ¼ãƒå­—ã§å…¥åŠ›ã€‚æ­£ã—ãæ‰“ã¦ã°å³åº§ã«æ¬¡ã®å˜èªãŒå‡ºç¾ã—ã¾ã™ã€‚<br>
        3å•æ­£è§£ã™ã‚‹ã¾ã§ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ã«æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼
      </div>

      <div class="row" id="stats">
        <div class="stat">
          <div class="label">çµŒéæ™‚é–“</div>
          <div class="val" id="elapsed">0.0s</div>
        </div>
        <div class="stat">
          <div class="label">ã‚¯ãƒªã‚¢æ•°</div>
          <div class="val"><span id="cleared">0</span> / 3</div>
        </div>
      </div>

      <div class="progress-area">
        <div class="runner paused" id="runner" aria-hidden="true">
          <svg viewBox="0 0 80 60">
            <circle cx="48" cy="12" r="8"></circle>
            <path d="M32 54 L42 32 L32 26" />
            <path d="M42 32 L56 42" />
            <path d="M42 32 L30 40" />
            <path d="M42 20 L28 28" />
            <path d="M42 20 L56 24" />
          </svg>
        </div>
        <div class="progress" id="progress" aria-label="ã‚¯ãƒªã‚¢çŠ¶æ³ï¼ˆ3æœ¬ã®ãƒãƒ£ãƒ¼ã‚¸ãƒãƒ¼ï¼‰">
          <span class="slot"></span>
          <span class="slot"></span>
          <span class="slot"></span>
        </div>
      </div>

      <div class="word-display">
        <div class="kana" id="currentKana">---</div>
        <div class="roma" id="currentRoma">---</div>
      </div>

      <input
        id="input"
        type="text"
        inputmode="latin"
        autocomplete="off"
        placeholder="æ­£ã—ããƒ­ãƒ¼ãƒå­—ã§å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•ã§æ¬¡ã®å˜èªã¸"
      />
      <div class="hint">
        æ—¥æœ¬èªIMEã¯ã‚ªãƒ•ï¼ˆè‹±å­—ãƒ¢ãƒ¼ãƒ‰ï¼‰ã§ãƒ—ãƒ¬ã‚¤ã—ã¦ãã ã•ã„ã€‚3æœ¬ã®ãƒãƒ¼ãŒã™ã¹ã¦åŸ‹ã¾ã‚‹ã¾ã§ã®æ™‚é–“ã‚’ç«¶ã„ã¾ã™ã€‚
      </div>

      <div class="controls">
        <button class="primary" id="btnStart">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="btnRestart" disabled>ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="btnShuffle">å˜èªå…¥ã‚Œæ›¿ãˆ</button>
      </div>

      <div class="footer">
        <div>å˜èªãƒªã‚¹ãƒˆ: ãƒ•ãƒ«ãƒ¼ãƒ„ï¼ˆã²ã‚‰ãŒãª & ãƒ­ãƒ¼ãƒå­—ï¼‰</div>
        <div>æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢ï¼šæ¿éŸ³ãƒ»æ‹—éŸ³å¯¾å¿œã€ãƒ«ãƒ¼ãƒ«è¿½åŠ ã€ãƒ©ãƒƒãƒ—è¨ˆæ¸¬ãªã©</div>
      </div>
    </div>
  </div>

  <script>
    const FRUITS = [
      { kana: "ã‚Šã‚“ã”",      roma: "ringo" },
      { kana: "ã¿ã‹ã‚“",      roma: "mikan" },
      { kana: "ã¶ã©ã†",      roma: "budou" },
      { kana: "ã„ã¡ã”",      roma: "ichigo" },
      { kana: "ã‚‚ã‚‚",        roma: "momo" },
      { kana: "ã™ã„ã‹",      roma: "suika" },
      { kana: "ãªã—",        roma: "nashi" },
      { kana: "ã‹ã",        roma: "kaki" },
      { kana: "ã•ãã‚‰ã‚“ã¼",  roma: "sakuranbo" },
      { kana: "ãƒãƒŠãƒŠ",      roma: "banana" },
      { kana: "ã‚­ã‚¦ã‚¤",      roma: "kiui" },
      { kana: "ãƒ‘ã‚¤ãƒŠãƒƒãƒ—ãƒ«",roma: "painappuru" },
      { kana: "ãƒãƒ³ã‚´ãƒ¼",    roma: "mango" },
      { kana: "ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„", roma: "gureepufurutsu" },
      { kana: "ãƒ¬ãƒ¢ãƒ³",      roma: "remon" },
      { kana: "ãƒ©ã‚¤ãƒ ",      roma: "raimu" },
      { kana: "ãƒ¡ãƒ­ãƒ³",      roma: "meron" },
      { kana: "ãƒ‘ãƒ‘ã‚¤ãƒ¤",    roma: "papaiya" },
      { kana: "ãƒ©ãƒ•ãƒ©ãƒ³ã‚¹",  roma: "rafuransu" },
      { kana: "ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼",roma: "buruuberii" },
      { kana: "ãƒ©ã‚ºãƒ™ãƒªãƒ¼",  roma: "razuberii" },
      { kana: "ã‚ªãƒ¬ãƒ³ã‚¸",    roma: "orenji" }
    ];

    const GOAL_COUNT = 3;
    const state = {
      words: [],
      idx: 0,
      startedAt: null,
      finished: false,
      timerId: null,
      correct: 0,
    };

    const $ = (sel) => document.querySelector(sel);
    const fmt = (n, digits = 1) =>
      (Math.round(n * Math.pow(10, digits)) / Math.pow(10, digits)).toFixed(digits);

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function ensureWordPool(){
      if(state.idx >= state.words.length){
        state.words = state.words.concat(shuffle(FRUITS));
      }
    }

    function showCurrentWord(){
      ensureWordPool();
      const current = state.words[state.idx] || { kana: "---", roma: "---" };
      $("#currentKana").textContent = current.kana;
      $("#currentRoma").textContent = current.roma;
    }

    function updateProgress(){
      $("#cleared").textContent = state.correct;
      document.querySelectorAll(".progress .slot").forEach((slot, idx) => {
        slot.classList.toggle("filled", idx < state.correct);
      });
    }

    function updateStats(){
      const elapsed = state.startedAt ? Date.now() - state.startedAt : 0;
      $("#elapsed").textContent = fmt(elapsed / 1000, 1) + "s";
    }

    function setRunnerState(){
      const runner = $("#runner");
      if(!runner) return;
      runner.classList.toggle("paused", !state.startedAt);
      runner.classList.toggle("celebrate", state.finished);
    }

    function tick(){
      if(state.startedAt && !state.finished){
        updateStats();
      }
    }

    function init(customWords = null){
      const seed = customWords ? customWords.slice() : shuffle(FRUITS);
      state.words = seed;
      state.idx = 0;
      state.startedAt = null;
      state.finished = false;
      state.correct = 0;
      clearInterval(state.timerId);
      state.timerId = null;
      $("#input").value = "";
      $("#input").disabled = false;
      $("#btnRestart").disabled = true;
      updateProgress();
      updateStats();
      showCurrentWord();
      setRunnerState();
      $("#input").focus();
    }

    function start(){
      if(state.startedAt || state.finished) return;
      state.startedAt = Date.now();
      state.timerId = setInterval(tick, 100);
      $("#btnRestart").disabled = false;
      setRunnerState();
    }

    function handleCorrect(){
      state.correct++;
      state.idx++;
      $("#input").value = "";
      updateProgress();
      if(state.correct >= GOAL_COUNT){
        finish();
      } else {
        showCurrentWord();
      }
    }

    function finish(){
      if(state.finished) return;
      state.finished = true;
      clearInterval(state.timerId);
      state.timerId = null;
      $("#input").disabled = true;
      updateStats();
      setRunnerState();
      const total = state.startedAt ? fmt((Date.now() - state.startedAt)/1000, 1) : "0.0";
      setTimeout(()=>alert(`ğŸ 3å•ã‚¯ãƒªã‚¢ï¼ã‚¿ã‚¤ãƒ : ${total}s`), 80);
    }

    function handleInput(){
      if(state.finished) return;
      const typed = $("#input").value.trim().toLowerCase();
      const current = state.words[state.idx] || { roma: "" };
      if(typed.length && !state.startedAt){
        start();
      }
      if(typed && typed === current.roma.toLowerCase()){
        handleCorrect();
      }
    }

    $("#btnStart").addEventListener("click", () => {
      if(!state.startedAt){
        start();
        $("#input").focus();
      }
    });

    $("#btnRestart").addEventListener("click", () => init());
    $("#btnShuffle").addEventListener("click", () => init(shuffle(FRUITS)));

    $("#input").addEventListener("input", handleInput);
    $("#input").addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
      }
    });

    init();
  </script>
</body>
</html>
